var resultado  = [{"codTaxaAdministrativa":322,"codEmp":88130,"codLoja":570806763,"codOperadora":1,"codProduto":1,"nmeLoja":"000000000001002","nmeOperadora":"AMEX","nmeProduto":"AMEX","codUsuario":2835,"nroPlano1":null,"nroPlano2":null,"nroPlano3":null,"nroPlano4":null,"nroPlano5":null,"nroPlano6":null,"nroPlano7":null,"nroPlano8":null,"nroPlano9":null,"nroPlano11":null,"nroPlano12":null,"listaSalvar":[],"mapaId":{"PLANO_2":322},"nro_plano10":null},{"codTaxaAdministrativa":321,"codEmp":88130,"codLoja":570806763,"codOperadora":1,"codProduto":1,"nmeLoja":"000000000001002","nmeOperadora":"AMEX","nmeProduto":"AMEX","codUsuario":2835,"nroPlano1":0.2,"nroPlano2":null,"nroPlano3":null,"nroPlano4":null,"nroPlano5":null,"nroPlano6":null,"nroPlano7":null,"nroPlano8":null,"nroPlano9":null,"nroPlano11":null,"nroPlano12":null,"listaSalvar":[],"mapaId":{"PLANO_1":321},"nro_plano10":null},{"codTaxaAdministrativa":441,"codEmp":88130,"codLoja":570831708,"codOperadora":1,"codProduto":1,"nmeLoja":"9919240580","nmeOperadora":"AMEX","nmeProduto":"AMEX","codUsuario":2835,"nroPlano1":0.05,"nroPlano2":null,"nroPlano3":null,"nroPlano4":null,"nroPlano5":null,"nroPlano6":null,"nroPlano7":null,"nroPlano8":null,"nroPlano9":null,"nroPlano11":null,"nroPlano12":null,"listaSalvar":[],"mapaId":{"PLANO_1":441},"nro_plano10":null},{"codTaxaAdministrativa":323,"codEmp":88130,"codLoja":570806763,"codOperadora":1,"codProduto":1,"nmeLoja":"000000000001002","nmeOperadora":"AMEX","nmeProduto":"AMEX","codUsuario":2835,"nroPlano1":null,"nroPlano2":null,"nroPlano3":null,"nroPlano4":null,"nroPlano5":null,"nroPlano6":null,"nroPlano7":null,"nroPlano8":null,"nroPlano9":null,"nroPlano11":null,"nroPlano12":null,"listaSalvar":[],"mapaId":{"PLANO_5":323},"nro_plano10":null},{"codTaxaAdministrativa":1081,"codEmp":88130,"codLoja":570806763,"codOperadora":1,"codProduto":1,"nmeLoja":"000000000001002","nmeOperadora":"AMEX","nmeProduto":"AMEX","codUsuario":2835,"nroPlano1":null,"nroPlano2":null,"nroPlano3":null,"nroPlano4":null,"nroPlano5":null,"nroPlano6":null,"nroPlano7":null,"nroPlano8":null,"nroPlano9":null,"nroPlano11":null,"nroPlano12":null,"listaSalvar":[],"mapaId":{"PLANO_2":1081},"nro_plano10":null},{"codTaxaAdministrativa":1042,"codEmp":88130,"codLoja":570806763,"codOperadora":1,"codProduto":1,"nmeLoja":"000000000001002","nmeOperadora":"AMEX","nmeProduto":"AMEX","codUsuario":2835,"nroPlano1":0.1,"nroPlano2":null,"nroPlano3":null,"nroPlano4":null,"nroPlano5":null,"nroPlano6":null,"nroPlano7":null,"nroPlano8":null,"nroPlano9":null,"nroPlano11":null,"nroPlano12":null,"listaSalvar":[],"mapaId":{"PLANO_1":1042},"nro_plano10":null},{"codTaxaAdministrativa":1041,"codEmp":88130,"codLoja":570806763,"codOperadora":1,"codProduto":1,"nmeLoja":"000000000001002","nmeOperadora":"AMEX","nmeProduto":"AMEX","codUsuario":2835,"nroPlano1":null,"nroPlano2":null,"nroPlano3":null,"nroPlano4":null,"nroPlano5":null,"nroPlano6":null,"nroPlano7":null,"nroPlano8":null,"nroPlano9":null,"nroPlano11":null,"nroPlano12":null,"listaSalvar":[],"mapaId":{"PLANO_1":1041},"nro_plano10":null},{"codTaxaAdministrativa":481,"codEmp":88130,"codLoja":570839723,"codOperadora":1,"codProduto":1,"nmeLoja":"000000000027652","nmeOperadora":"AMEX","nmeProduto":"AMEX","codUsuario":2835,"nroPlano1":0.02,"nroPlano2":null,"nroPlano3":null,"nroPlano4":null,"nroPlano5":null,"nroPlano6":null,"nroPlano7":null,"nroPlano8":null,"nroPlano9":null,"nroPlano11":null,"nroPlano12":null,"listaSalvar":[],"mapaId":{"PLANO_1":481},"nro_plano10":null},{"codTaxaAdministrativa":1067,"codEmp":88130,"codLoja":570806763,"codOperadora":1,"codProduto":1,"nmeLoja":"000000000001002","nmeOperadora":"AMEX","nmeProduto":"AMEX","codUsuario":2835,"nroPlano1":null,"nroPlano2":null,"nroPlano3":15,"nroPlano4":null,"nroPlano5":null,"nroPlano6":null,"nroPlano7":null,"nroPlano8":null,"nroPlano9":null,"nroPlano11":null,"nroPlano12":null,"listaSalvar":[],"mapaId":{"PLANO_3":1067},"nro_plano10":null},{"codTaxaAdministrativa":1066,"codEmp":88130,"codLoja":570806763,"codOperadora":1,"codProduto":1,"nmeLoja":"000000000001002","nmeOperadora":"AMEX","nmeProduto":"AMEX","codUsuario":2835,"nroPlano1":null,"nroPlano2":10,"nroPlano3":null,"nroPlano4":null,"nroPlano5":null,"nroPlano6":null,"nroPlano7":null,"nroPlano8":null,"nroPlano9":null,"nroPlano11":null,"nroPlano12":null,"listaSalvar":[],"mapaId":{"PLANO_2":1066},"nro_plano10":null},{"codTaxaAdministrativa":1065,"codEmp":88130,"codLoja":570806763,"codOperadora":1,"codProduto":1,"nmeLoja":"000000000001002","nmeOperadora":"AMEX","nmeProduto":"AMEX","codUsuario":2835,"nroPlano1":null,"nroPlano2":null,"nroPlano3":3,"nroPlano4":null,"nroPlano5":null,"nroPlano6":null,"nroPlano7":null,"nroPlano8":null,"nroPlano9":null,"nroPlano11":null,"nroPlano12":null,"listaSalvar":[],"mapaId":{"PLANO_3":1065},"nro_plano10":null},{"codTaxaAdministrativa":1064,"codEmp":88130,"codLoja":570806763,"codOperadora":1,"codProduto":1,"nmeLoja":"000000000001002","nmeOperadora":"AMEX","nmeProduto":"AMEX","codUsuario":2835,"nroPlano1":null,"nroPlano2":2,"nroPlano3":null,"nroPlano4":null,"nroPlano5":null,"nroPlano6":null,"nroPlano7":null,"nroPlano8":null,"nroPlano9":null,"nroPlano11":null,"nroPlano12":null,"listaSalvar":[],"mapaId":{"PLANO_2":1064},"nro_plano10":null},{"codTaxaAdministrativa":1063,"codEmp":88130,"codLoja":570806763,"codOperadora":1,"codProduto":1,"nmeLoja":"000000000001002","nmeOperadora":"AMEX","nmeProduto":"AMEX","codUsuario":2835,"nroPlano1":null,"nroPlano2":null,"nroPlano3":3,"nroPlano4":null,"nroPlano5":null,"nroPlano6":null,"nroPlano7":null,"nroPlano8":null,"nroPlano9":null,"nroPlano11":null,"nroPlano12":null,"listaSalvar":[],"mapaId":{"PLANO_3":1063},"nro_plano10":null},{"codTaxaAdministrativa":1062,"codEmp":88130,"codLoja":570806763,"codOperadora":1,"codProduto":1,"nmeLoja":"000000000001002","nmeOperadora":"AMEX","nmeProduto":"AMEX","codUsuario":2835,"nroPlano1":null,"nroPlano2":2,"nroPlano3":null,"nroPlano4":null,"nroPlano5":null,"nroPlano6":null,"nroPlano7":null,"nroPlano8":null,"nroPlano9":null,"nroPlano11":null,"nroPlano12":null,"listaSalvar":[],"mapaId":{"PLANO_2":1062},"nro_plano10":null},{"codTaxaAdministrativa":1061,"codEmp":88130,"codLoja":570806763,"codOperadora":1,"codProduto":1,"nmeLoja":"000000000001002","nmeOperadora":"AMEX","nmeProduto":"AMEX","codUsuario":2835,"nroPlano1":null,"nroPlano2":2,"nroPlano3":null,"nroPlano4":null,"nroPlano5":null,"nroPlano6":null,"nroPlano7":null,"nroPlano8":null,"nroPlano9":null,"nroPlano11":null,"nroPlano12":null,"listaSalvar":[],"mapaId":{"PLANO_2":1061},"nro_plano10":null},{"codTaxaAdministrativa":983,"codEmp":88130,"codLoja":570839723,"codOperadora":1,"codProduto":1,"nmeLoja":"000000000027652","nmeOperadora":"AMEX","nmeProduto":"AMEX","codUsuario":2835,"nroPlano1":null,"nroPlano2":0.35,"nroPlano3":null,"nroPlano4":null,"nroPlano5":null,"nroPlano6":null,"nroPlano7":null,"nroPlano8":null,"nroPlano9":null,"nroPlano11":null,"nroPlano12":null,"listaSalvar":[],"mapaId":{"PLANO_2":983},"nro_plano10":null}]


//para colocar nas taxas nulas
// var taxaAdmVazia = {
//   "codEmp": "",
//   "codLoja": "",
//   "codOperadora": "",
//   "codProduto": "",
//   "nmeLoja": "",
//   "nmeOperadora": "",
//   "nmeProduto": "",
//   "codUsuario": "",
//   "nroPlano1": null,
//   "nroPlano2": null,
//   "nroPlano3": null,
//   "nroPlano4": null,
//   "nroPlano5": null,
//   "nroPlano6": null,
//   "nroPlano7": null,
//   "nroPlano8": null,
//   "nroPlano9": null,
//   "nroPlano10": null,
//   "nroPlano11": null,
//   "nroPlano12": null,
//   "listaSalvar":[

//   ]
// };

//json que vai no array de resultado filtrado.
var taxaUnica = {
  "id": "",
  "codLoja": "",
  "codEmp": "",
  "codOperadora": "",
  "codProduto": "",
  "nmeLoja": "",
  "nmeOperadora": "",
  "nmeProduto": "",
  "codUsuario": "",
  "taxas": new Array(12)
};

//usado nas funcoes de agrupar o resultado da pesquisa
var resultadoFiltrado = [];

function newTaxaUnica(taxa) {
  taxaUnica = new Object();
  taxaUnica.id = taxa.codLoja + "" + taxa.codOperadora + "" + taxa.codProduto;
  taxaUnica.codLoja = taxa.codLoja;
  taxaUnica.codEmp = taxa.codEmp;
  taxaUnica.codOperadora = taxa.codOperadora;
  taxaUnica.codProduto = taxa.codProduto;
  taxaUnica.nmeLoja = taxa.nmeLoja;
  taxaUnica.nmeOperadora = taxa.nmeOperadora;
  taxaUnica.nmeProduto = taxa.nmeProduto;
  taxaUnica.codUsuario = taxa.codUsuario;
  taxaUnica.taxas = new Array(12);
  return taxaUnica;
}


//para colocar nas taxas nulas
function newTaxaAdmVazia() {
  return {
    "codEmp": "",
    "codLoja": "",
    "codOperadora": "",
    "codProduto": "",
    "nmeLoja": "",
    "nmeOperadora": "",
    "nmeProduto": "",
    "codUsuario": "",
    "nro_plano1": null,
    "nro_plano2": null,
    "nro_plano3": null,
    "nro_plano4": null,
    "nro_plano5": null,
    "nro_plano6": null,
    "nro_plano7": null,
    "nro_plano8": null,
    "nro_plano9": null,
    "nro_plano10": null,
    "nro_plano11": null,
    "nro_plano12": null,
    "listaSalvar":[
  
    ]
  };
}

function agruparResultado(resultado) {

  resultadoFiltrado = [];

  if(resultado.length > 0) {
      var index;
      var taxa = resultado[0];
      taxaUnica = newTaxaUnica(taxa);
      // taxaUnica.id = taxa.codLoja + "" + taxa.codOperadora + "" + taxa.codProduto;
      // taxaUnica.codLoja = taxa.codLoja;
      // taxaUnica.codOperadora = taxa.codOperadora;
      // taxaUnica.nmeOperadora = taxa.nmeOperadora;
      // taxaUnica.nmeProduto = taxa.nmeProduto;
      resultadoFiltrado.push(taxaUnica);
  }
  
  resultado.forEach(taxa => {
      var temTaxa = false;
      var taxaId = taxa.codLoja + "" + taxa.codOperadora + "" + taxa.codProduto;
      var txFiltradaIndex;
  
      resultadoFiltrado.forEach((taxaFiltrada, index) => {
      
          if(taxaId === taxaFiltrada.id) {
              temTaxa = true;
              txFiltradaIndex = index
          }
      });
  
      if(temTaxa){
          atualizaTaxaUnica(taxa, txFiltradaIndex)
      } else{
          pushTaxaUnica(taxa);
      }
  });

  return resultadoFiltrado;
}


function atualizaTaxaUnica(taxa, txFiltradaIndex) {
  var taxaFiltrada = resultadoFiltrado[txFiltradaIndex];
  taxaMapIdIndex = Object.keys(taxa.mapaId)[0].replace("PLANO_", "") - 1;

  if(!taxaFiltrada.taxas[taxaMapIdIndex]) {
      taxaFiltrada.taxas[taxaMapIdIndex] = taxa;
  }
}


function pushTaxaUnica(taxa) {
  var index;
  var taxaUnica = newTaxaUnica(taxa);

  index = Object.keys(taxa.mapaId)[0].replace("PLANO_", "") - 1;

  // taxaUnica = new Object();
  // taxaUnica.id = taxa.codLoja + "" + taxa.codOperadora + "" + taxa.codProduto;
  // taxaUnica.codLoja = taxa.codLoja;
  // taxaUnica.codOperadora = taxa.codOperadora;
  // taxaUnica.nmeOperadora = taxa.nmeOperadora;
  // taxaUnica.nmeProduto = taxa.nmeProduto;
  // taxaUnica.taxas = new Array(12);
  taxaUnica.taxas[index] = taxa;
  resultadoFiltrado.push(taxaUnica);
}

function preencheTaxasNulas() {
  resultadoFiltrado.forEach(produto => {
    var taxaAdmNova = newTaxaAdmVazia();

    for(i = 0; i < produto.taxas.length; i++) {
      
      if(!produto.taxas[i]) {
        taxaAdmNova.codEmp = produto.codEmp;
        taxaAdmNova.codLoja = produto.codLoja;
        taxaAdmNova.codOperadora = produto.codOperadora;
        taxaAdmNova.codProduto = produto.codProduto;
        taxaAdmNova.nmeLoja = produto.nmeLoja;
        taxaAdmNova.nmeOperadora = produto.nmeOperadora;
        taxaAdmNova.nmeProduto = produto.nmeProduto;
        taxaAdmNova.codUsuario = produto.codUsuario;
        produto.taxas[i] = taxaAdmNova;
      }
    }
  })
}



// teste
agruparResultado(resultado);
preencheTaxasNulas()
// console.log(JSON.stringify(resultadoFiltrado, undefined, 2))
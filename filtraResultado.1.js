var resultado  = [{"codTaxaAdministrativa":322,"codEmp":88130,"codLoja":570806763,"codOperadora":1,"codProduto":1,"nmeLoja":"000000000001002","nmeOperadora":"AMEX","nmeProduto":"AMEX","codUsuario":2835,"nroPlano1":null,"nroPlano2":null,"nroPlano3":null,"nroPlano4":null,"nroPlano5":null,"nroPlano6":null,"nroPlano7":null,"nroPlano8":null,"nroPlano9":null,"nroPlano11":null,"nroPlano12":null,"listaSalvar":[],"mapaId":{"PLANO_2":322},"nro_plano10":null},{"codTaxaAdministrativa":321,"codEmp":88130,"codLoja":570806763,"codOperadora":1,"codProduto":1,"nmeLoja":"000000000001002","nmeOperadora":"AMEX","nmeProduto":"AMEX","codUsuario":2835,"nroPlano1":0.2,"nroPlano2":null,"nroPlano3":null,"nroPlano4":null,"nroPlano5":null,"nroPlano6":null,"nroPlano7":null,"nroPlano8":null,"nroPlano9":null,"nroPlano11":null,"nroPlano12":null,"listaSalvar":[],"mapaId":{"PLANO_1":321},"nro_plano10":null},{"codTaxaAdministrativa":441,"codEmp":88130,"codLoja":570831708,"codOperadora":1,"codProduto":1,"nmeLoja":"9919240580","nmeOperadora":"AMEX","nmeProduto":"AMEX","codUsuario":2835,"nroPlano1":0.05,"nroPlano2":null,"nroPlano3":null,"nroPlano4":null,"nroPlano5":null,"nroPlano6":null,"nroPlano7":null,"nroPlano8":null,"nroPlano9":null,"nroPlano11":null,"nroPlano12":null,"listaSalvar":[],"mapaId":{"PLANO_1":441},"nro_plano10":null},{"codTaxaAdministrativa":323,"codEmp":88130,"codLoja":570806763,"codOperadora":1,"codProduto":1,"nmeLoja":"000000000001002","nmeOperadora":"AMEX","nmeProduto":"AMEX","codUsuario":2835,"nroPlano1":null,"nroPlano2":null,"nroPlano3":null,"nroPlano4":null,"nroPlano5":null,"nroPlano6":null,"nroPlano7":null,"nroPlano8":null,"nroPlano9":null,"nroPlano11":null,"nroPlano12":null,"listaSalvar":[],"mapaId":{"PLANO_5":323},"nro_plano10":null},{"codTaxaAdministrativa":1081,"codEmp":88130,"codLoja":570806763,"codOperadora":1,"codProduto":1,"nmeLoja":"000000000001002","nmeOperadora":"AMEX","nmeProduto":"AMEX","codUsuario":2835,"nroPlano1":null,"nroPlano2":null,"nroPlano3":null,"nroPlano4":null,"nroPlano5":null,"nroPlano6":null,"nroPlano7":null,"nroPlano8":null,"nroPlano9":null,"nroPlano11":null,"nroPlano12":null,"listaSalvar":[],"mapaId":{"PLANO_2":1081},"nro_plano10":null},{"codTaxaAdministrativa":1042,"codEmp":88130,"codLoja":570806763,"codOperadora":1,"codProduto":1,"nmeLoja":"000000000001002","nmeOperadora":"AMEX","nmeProduto":"AMEX","codUsuario":2835,"nroPlano1":0.1,"nroPlano2":null,"nroPlano3":null,"nroPlano4":null,"nroPlano5":null,"nroPlano6":null,"nroPlano7":null,"nroPlano8":null,"nroPlano9":null,"nroPlano11":null,"nroPlano12":null,"listaSalvar":[],"mapaId":{"PLANO_1":1042},"nro_plano10":null},{"codTaxaAdministrativa":1041,"codEmp":88130,"codLoja":570806763,"codOperadora":1,"codProduto":1,"nmeLoja":"000000000001002","nmeOperadora":"AMEX","nmeProduto":"AMEX","codUsuario":2835,"nroPlano1":null,"nroPlano2":null,"nroPlano3":null,"nroPlano4":null,"nroPlano5":null,"nroPlano6":null,"nroPlano7":null,"nroPlano8":null,"nroPlano9":null,"nroPlano11":null,"nroPlano12":null,"listaSalvar":[],"mapaId":{"PLANO_1":1041},"nro_plano10":null},{"codTaxaAdministrativa":481,"codEmp":88130,"codLoja":570839723,"codOperadora":1,"codProduto":1,"nmeLoja":"000000000027652","nmeOperadora":"AMEX","nmeProduto":"AMEX","codUsuario":2835,"nroPlano1":0.02,"nroPlano2":null,"nroPlano3":null,"nroPlano4":null,"nroPlano5":null,"nroPlano6":null,"nroPlano7":null,"nroPlano8":null,"nroPlano9":null,"nroPlano11":null,"nroPlano12":null,"listaSalvar":[],"mapaId":{"PLANO_1":481},"nro_plano10":null},{"codTaxaAdministrativa":1067,"codEmp":88130,"codLoja":570806763,"codOperadora":1,"codProduto":1,"nmeLoja":"000000000001002","nmeOperadora":"AMEX","nmeProduto":"AMEX","codUsuario":2835,"nroPlano1":null,"nroPlano2":null,"nroPlano3":15,"nroPlano4":null,"nroPlano5":null,"nroPlano6":null,"nroPlano7":null,"nroPlano8":null,"nroPlano9":null,"nroPlano11":null,"nroPlano12":null,"listaSalvar":[],"mapaId":{"PLANO_3":1067},"nro_plano10":null},{"codTaxaAdministrativa":1066,"codEmp":88130,"codLoja":570806763,"codOperadora":1,"codProduto":1,"nmeLoja":"000000000001002","nmeOperadora":"AMEX","nmeProduto":"AMEX","codUsuario":2835,"nroPlano1":null,"nroPlano2":10,"nroPlano3":null,"nroPlano4":null,"nroPlano5":null,"nroPlano6":null,"nroPlano7":null,"nroPlano8":null,"nroPlano9":null,"nroPlano11":null,"nroPlano12":null,"listaSalvar":[],"mapaId":{"PLANO_2":1066},"nro_plano10":null},{"codTaxaAdministrativa":1065,"codEmp":88130,"codLoja":570806763,"codOperadora":1,"codProduto":1,"nmeLoja":"000000000001002","nmeOperadora":"AMEX","nmeProduto":"AMEX","codUsuario":2835,"nroPlano1":null,"nroPlano2":null,"nroPlano3":3,"nroPlano4":null,"nroPlano5":null,"nroPlano6":null,"nroPlano7":null,"nroPlano8":null,"nroPlano9":null,"nroPlano11":null,"nroPlano12":null,"listaSalvar":[],"mapaId":{"PLANO_3":1065},"nro_plano10":null},{"codTaxaAdministrativa":1064,"codEmp":88130,"codLoja":570806763,"codOperadora":1,"codProduto":1,"nmeLoja":"000000000001002","nmeOperadora":"AMEX","nmeProduto":"AMEX","codUsuario":2835,"nroPlano1":null,"nroPlano2":2,"nroPlano3":null,"nroPlano4":null,"nroPlano5":null,"nroPlano6":null,"nroPlano7":null,"nroPlano8":null,"nroPlano9":null,"nroPlano11":null,"nroPlano12":null,"listaSalvar":[],"mapaId":{"PLANO_2":1064},"nro_plano10":null},{"codTaxaAdministrativa":1063,"codEmp":88130,"codLoja":570806763,"codOperadora":1,"codProduto":1,"nmeLoja":"000000000001002","nmeOperadora":"AMEX","nmeProduto":"AMEX","codUsuario":2835,"nroPlano1":null,"nroPlano2":null,"nroPlano3":3,"nroPlano4":null,"nroPlano5":null,"nroPlano6":null,"nroPlano7":null,"nroPlano8":null,"nroPlano9":null,"nroPlano11":null,"nroPlano12":null,"listaSalvar":[],"mapaId":{"PLANO_3":1063},"nro_plano10":null},{"codTaxaAdministrativa":1062,"codEmp":88130,"codLoja":570806763,"codOperadora":1,"codProduto":1,"nmeLoja":"000000000001002","nmeOperadora":"AMEX","nmeProduto":"AMEX","codUsuario":2835,"nroPlano1":null,"nroPlano2":2,"nroPlano3":null,"nroPlano4":null,"nroPlano5":null,"nroPlano6":null,"nroPlano7":null,"nroPlano8":null,"nroPlano9":null,"nroPlano11":null,"nroPlano12":null,"listaSalvar":[],"mapaId":{"PLANO_2":1062},"nro_plano10":null},{"codTaxaAdministrativa":1061,"codEmp":88130,"codLoja":570806763,"codOperadora":1,"codProduto":1,"nmeLoja":"000000000001002","nmeOperadora":"AMEX","nmeProduto":"AMEX","codUsuario":2835,"nroPlano1":null,"nroPlano2":2,"nroPlano3":null,"nroPlano4":null,"nroPlano5":null,"nroPlano6":null,"nroPlano7":null,"nroPlano8":null,"nroPlano9":null,"nroPlano11":null,"nroPlano12":null,"listaSalvar":[],"mapaId":{"PLANO_2":1061},"nro_plano10":null},{"codTaxaAdministrativa":983,"codEmp":88130,"codLoja":570839723,"codOperadora":1,"codProduto":1,"nmeLoja":"000000000027652","nmeOperadora":"AMEX","nmeProduto":"AMEX","codUsuario":2835,"nroPlano1":null,"nroPlano2":0.35,"nroPlano3":null,"nroPlano4":null,"nroPlano5":null,"nroPlano6":null,"nroPlano7":null,"nroPlano8":null,"nroPlano9":null,"nroPlano11":null,"nroPlano12":null,"listaSalvar":[],"mapaId":{"PLANO_2":983},"nro_plano10":null}]
var resultadoFiltrado = [];

var taxaUnica = {
  "id": "",
  "codLoja": "",
  "nmeOperadora": "",
  "nmeProduto": "",
  "taxas": new Array(12)
};

function agruparResultado() {
  if(resultado.length > 0) {
    var index;
    var taxa = resultado[0];
    taxaUnica.id = taxa.codLoja + "" + taxa.codOperadora + "" + taxa.codProduto;
    taxaUnica.codLoja = taxa.codLoja;
    taxaUnica.nmeOperadora = taxa.nmeOperadora;
    taxaUnica.nmeProduto = taxa.nmeProduto;
    resultadoFiltrado.push(taxaUnica);
  }
  
  resultado.forEach(taxa => {
    var temTaxa = false;
    var taxaId = taxa.codLoja + "" + taxa.codOperadora + "" + taxa.codProduto;
    var txFiltradaIndex;
  
    resultadoFiltrado.forEach((taxaFiltrada, index) => {
      
      if(taxaId === taxaFiltrada.id) {
        temTaxa = true;
        txFiltradaIndex = index
      }
    });
  
    if(temTaxa){
      atualizaTaxaUnica(taxa, txFiltradaIndex)
    } else{
      pushTaxaUnica(taxa);
    }
  });
}


function atualizaTaxaUnica(taxa, txFiltradaIndex) {
  var taxaFiltrada = resultadoFiltrado[txFiltradaIndex];
  taxaMapIdIndex = Object.keys(taxa.mapaId)[0].replace("PLANO_", "") - 1;
  if(!taxaFiltrada.taxas[taxaMapIdIndex]) {
    taxaFiltrada.taxas[taxaMapIdIndex] = taxa;
  }
}


function pushTaxaUnica(taxa) {
  var index;
  taxaUnica = new Object();
  taxaUnica.id = taxa.codLoja + "" + taxa.codOperadora + "" + taxa.codProduto;
  taxaUnica.codLoja = taxa.codLoja;
  taxaUnica.nmeOperadora = taxa.nmeOperadora;
  taxaUnica.nmeProduto = taxa.nmeProduto;
  index = Object.keys(taxa.mapaId)[0].replace("PLANO_", "") - 1;
  taxaUnica.taxas = new Array(12);
  taxaUnica.taxas[index] = taxa;
  resultadoFiltrado.push(taxaUnica);
}


// console.log(JSON.stringify(resultadoFiltrado, undefined, 2))
// console.log(resultadoFiltrado);
// console.log(resultadoFiltrado.length);
